pipeline { agent any environment { DOCKER_USER = 'kesavan371' DEV_REPO = "${DOCKER_USER}/dev" PROD_REPO = "${DOCKER_USER}/prod" DOCKER_CREDS = 'fe477cf2-747e-4712-8a6c-69035287b04d' } stages { stage('Build & Push') { steps { script { def targetRepo = "" if (env.BRANCH_NAME == 'dev') { targetRepo = DEV_REPO echo "Targeting DEV repository: ${targetRepo}" } else if (env.BRANCH_NAME == 'master' || env.BRANCH_NAME == 'main') { targetRepo = PROD_REPO echo "Targeting PROD repository: ${targetRepo}" } else { error "Pushing images for branch ${env.BRANCH_NAME} is not allowed." } def img = docker.build("${targetRepo}:${env.BUILD_NUMBER}") docker.withRegistry('https://index.docker.io/v1/', DOCKER_CREDS) { img.push() img.push('latest') } } } } } }
